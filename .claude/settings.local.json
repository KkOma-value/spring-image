{
  "permissions": {
    "allow": [
      "Bash(gh:*)",
      "Bash(git init:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\ninit\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nadd components, services, and source files\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nupdate README with project details and bilingual documentation\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git remote get-url:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nUpdate auth UI components\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git symbolic-ref:*)",
      "Bash(git commit:*)",
      "Bash(git remote set-url:*)",
      "Bash(npm run build:*)",
      "Bash(dir:*)",
      "Bash(ls:*)",
      "Bash(xargs:*)",
      "Bash(cat:*)",
      "Bash(wc -l:*)",
      "Bash(\"D:\\\\nextjs-code\\\\spring-image\\\\docs\\\\database.md\" << 'EOF'\n# Database Documentation\n\n## Overview\n\nSpring Image uses PostgreSQL with Drizzle ORM for type-safe database operations.\n\n## Schema Structure\n\n### Auth Tables\n\n#### User\n- Primary user account information\n- Indexed fields: email, username, role, createdAt\n- Row Level Security \\(RLS\\) enabled\n\n#### Session\n- Authentication sessions with Better Auth\n- Indexed: token, userId, expiresAt\n- Auto-cleanup support via expiresAt index\n\n#### Account\n- OAuth provider account linking\n\n### Billing Tables\n\n#### Credit Balance\n- Real-time credit tracking per user\n- Atomic increment/decrement operations\n- Cascade delete with user\n\n#### Credit Transaction\n- Audit trail of all credit changes\n- Indexed: userId, createdAt \\(composite\\)\n- Transaction types: image_generation, checkout, refund\n\n#### Payment History\n- Stripe payment records\n- Unique constraint: stripeSessionId \\(idempotency\\)\n- Indexed: userId, createdAt\n\n## Performance\n\n### Connection Pooling\n- Max connections: 10 \\(production\\)\n- Idle timeout: 20s\n- Connection lifetime: 30min\n- Prepared statements enabled\n\n### Indexes\nAll foreign keys and query fields have indexes for optimal performance.\n\n## Migrations\n\n```bash\nnpm run db:generate   # Generate migration\nnpm run db:migrate    # Apply migrations\nnpm run db:studio     # Open Drizzle Studio\n```\n\n## Backup\n\n```bash\npg_dump $DATABASE_URL > backup_$\\(date +%Y%m%d\\).sql\n```\nEOF)",
      "Bash(\"D:\\\\nextjs-code\\\\spring-image\\\\docs\\\\deployment.md\" << 'EOF'\n# Deployment Guide\n\n## Requirements\n\n- Node.js 18+\n- PostgreSQL 14+\n- Stripe Account\n- Google Cloud Console Account\n- Vercel Account \\(recommended\\)\n\n## Environment Setup\n\n### 1. Database\n\n```bash\n# Create PostgreSQL database\ncreatedb spring_image\n\n# Set DATABASE_URL\nexport DATABASE_URL=\"postgresql://user:pass@localhost:5432/spring_image\"\n```\n\n### 2. Authentication\n\n1. Go to [Google Cloud Console]\\(https://console.cloud.google.com/\\)\n2. Create OAuth 2.0 credentials\n3. Add authorized redirect URI: `http://localhost:3000/api/auth/callback/google`\n4. Set environment variables:\n\n```env\nBETTER_AUTH_SECRET=your-secret-key\nBETTER_AUTH_URL=http://localhost:3000\nGOOGLE_CLIENT_ID=your-client-id\nGOOGLE_CLIENT_SECRET=your-client-secret\n```\n\n### 3. Stripe Setup\n\n1. Create Stripe account\n2. Create a product and price\n3. Get API keys and webhook secret\n4. Configure webhook endpoint: `https://yourdomain.com/api/webhook`\n\n```env\nSTRIPE_SECRET_KEY=sk_test_...\nSTRIPE_WEBHOOK_SECRET=whsec_...\nPRICE_ID=price_...\n```\n\n### 4. AI Service\n\nGet Gemini API key from [Google AI Studio]\\(https://aistudio.google.com/\\)\n\n```env\nGEMINI_API_KEY=your-api-key\n```\n\n### 5. File Storage\n\nGet Vercel Blob token:\n\n```bash\nvercel blobs --token\n```\n\n```env\nBLOB_READ_WRITE_TOKEN=vercel_blob_token\n```\n\n## Local Development\n\n```bash\n# Install dependencies\nnpm install\n\n# Run database migrations\nnpm run db:migrate\n\n# Start development server\nnpm run dev\n```\n\n## Production Deployment\n\n### Vercel \\(Recommended\\)\n\n1. Push code to GitHub\n2. Import project in Vercel\n3. Add all environment variables\n4. Deploy\n\n### Docker\n\n```dockerfile\nFROM node:18-alpine\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci --only=production\nCOPY . .\nRUN npm run build\nEXPOSE 3000\nCMD [\"npm\", \"start\"]\n```\n\n### Environment Variables Summary\n\n```env\n# Required\nDATABASE_URL=\nBETTER_AUTH_SECRET=\nBETTER_AUTH_URL=\nGOOGLE_CLIENT_ID=\nGOOGLE_CLIENT_SECRET=\nGEMINI_API_KEY=\nNEXT_PUBLIC_BASE_URL=\n\n# Payments \\(optional, for billing\\)\nSTRIPE_SECRET_KEY=\nSTRIPE_WEBHOOK_SECRET=\nPRICE_ID=\n\n# Storage \\(optional, for uploads\\)\nBLOB_READ_WRITE_TOKEN=\n```\n\n## Post-Deployment\n\n1. Run migrations: `npm run db:migrate`\n2. Test authentication flow\n3. Test image generation\n4. Test payment flow \\(use Stripe test mode\\)\n5. Monitor logs for errors\n\n## Troubleshooting\n\n| Issue | Solution |\n|-------|----------|\n| Database connection failed | Check DATABASE_URL format |\n| Auth not working | Verify BETTER_AUTH_URL matches domain |\n| Stripe webhooks failing | Check webhook secret and endpoint URL |\n| Image generation failed | Verify GEMINI_API_KEY |\nEOF)",
      "Bash(npx tsc:*)",
      "Bash(npx next build:*)"
    ]
  }
}
